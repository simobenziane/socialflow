{
    "name":  "W3: Late Scheduling v15.2",
    "nodes":  [
                  {
                      "parameters":  {
                                         "httpMethod":  "POST",
                                         "path":  "w3-schedule",
                                         "responseMode":  "responseNode",
                                         "options":  {

                                                     }
                                     },
                      "type":  "n8n-nodes-base.webhook",
                      "typeVersion":  2.1,
                      "position":  [
                                       -2368,
                                       400
                                   ],
                      "id":  "e4ae9004-1724-4cd7-a132-babd649dcff8",
                      "name":  "Webhook Trigger",
                      "webhookId":  "w3-schedule-webhook",
                      "onError":  "continueRegularOutput"
                  },
                  {
                      "parameters":  {
                                         "jsCode":  "/**\n * W3 v15: Load Config\n * Loads settings and determines client/batch filter\n */\nconst fs = require(\u0027fs\u0027);\n\nconsole.log(\u0027[W3] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\u0027);\nconsole.log(\u0027[W3] Starting Late Scheduling workflow v15\u0027);\nconsole.log(\u0027[W3] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\u0027);\n\nconst input = $input.first().json || {};\nconst CONFIG_BASE = \u0027/data/clients/_config\u0027;\nconst SETTINGS_PATH = `${CONFIG_BASE}/settings.json`;\nconst ACTIVE_JOB_PATH = `${CONFIG_BASE}/active_job.json`;\nconst DB_PATH = `${CONFIG_BASE}/socialflow.db`;\nconst startTime = Date.now();\n\n// Load settings\nif (!fs.existsSync(SETTINGS_PATH)) {\n  console.log(\u0027[W3] âœ— [CONFIG_MISSING] settings.json not found\u0027);\n  return [{ json: { _error: true, error_code: \u0027CONFIG_MISSING\u0027, error_message: `settings.json not found at ${SETTINGS_PATH}`, _start_time: startTime, _config_base: CONFIG_BASE } }];\n}\n\nlet settings;\ntry {\n  settings = JSON.parse(fs.readFileSync(SETTINGS_PATH, \u0027utf8\u0027));\n  console.log(\u0027[W3] âœ“ settings.json loaded\u0027);\n} catch (e) {\n  console.log(`[W3] âœ— [CONFIG_MISSING] Failed to parse settings.json: ${e.message}`);\n  return [{ json: { _error: true, error_code: \u0027CONFIG_MISSING\u0027, error_message: `Failed to parse settings.json: ${e.message}`, _start_time: startTime, _config_base: CONFIG_BASE } }];\n}\n\n// Check database\nif (!fs.existsSync(DB_PATH)) {\n  console.log(`[W3] âœ— [DB_NOT_FOUND] Database not found at ${DB_PATH}`);\n  return [{ json: { _error: true, error_code: \u0027DB_NOT_FOUND\u0027, error_message: `Database not found at ${DB_PATH}. Run init_database.js first.`, _start_time: startTime, _config_base: CONFIG_BASE } }];\n}\n\n// Determine client/batch filter\nlet CLIENT_FILTER, BATCH_FILTER;\nif (input.client || input.body?.client) {\n  CLIENT_FILTER = input.client || input.body?.client;\n  BATCH_FILTER = input.batch || input.body?.batch;\n  console.log(`[W3] â„¹ Using webhook payload: ${CLIENT_FILTER}/${BATCH_FILTER || \u0027all\u0027}`);\n} else {\n  try {\n    const activeJob = JSON.parse(fs.readFileSync(ACTIVE_JOB_PATH, \u0027utf8\u0027));\n    CLIENT_FILTER = activeJob.current?.client || activeJob.client;\n    BATCH_FILTER = activeJob.current?.batch || activeJob.batch;\n    console.log(`[W3] â„¹ Using active_job.json: ${CLIENT_FILTER}/${BATCH_FILTER || \u0027all\u0027}`);\n  } catch (e) {\n    console.log(\u0027[W3] â„¹ No active_job.json, processing all APPROVED items\u0027);\n  }\n}\n\nconst source = input.body ? \u0027webhook\u0027 : \u0027active_job\u0027;\nconsole.log(`[W3] â„¹ Source: ${source}`);\nif (CLIENT_FILTER) console.log(`[W3] â„¹ Filter by client: ${CLIENT_FILTER}`);\nif (BATCH_FILTER) console.log(`[W3] â„¹ Filter by batch: ${BATCH_FILTER}`);\n\n// Security: Validate slugs contain only safe characters (prevent path traversal)\nconst SAFE_SLUG = /^[a-zA-Z0-9_-]+$/;\nif (CLIENT_FILTER \u0026\u0026 !SAFE_SLUG.test(CLIENT_FILTER)) {\n  console.log(\u0027[W3] âœ— [INVALID_SLUG] Invalid characters in client slug\u0027);\n  return [{ json: { _error: true, error_code: \u0027INVALID_SLUG\u0027, error_message: `Invalid client slug format: ${CLIENT_FILTER}. Only alphanumeric, dash, and underscore allowed.`, _start_time: startTime, _config_base: CONFIG_BASE } }];\n}\nif (BATCH_FILTER \u0026\u0026 !SAFE_SLUG.test(BATCH_FILTER)) {\n  console.log(\u0027[W3] âœ— [INVALID_SLUG] Invalid characters in batch slug\u0027);\n  return [{ json: { _error: true, error_code: \u0027INVALID_SLUG\u0027, error_message: `Invalid batch slug format: ${BATCH_FILTER}. Only alphanumeric, dash, and underscore allowed.`, _start_time: startTime, _config_base: CONFIG_BASE } }];\n}\nif (CLIENT_FILTER || BATCH_FILTER) console.log(\u0027[W3] âœ“ Slug validation passed\u0027);\n\nconst CLOUDFLARE_URL = settings.cloudflare_tunnel_url || \u0027\u0027;\nif (!CLOUDFLARE_URL || CLOUDFLARE_URL.includes(\u0027PASTE-YOUR\u0027) || CLOUDFLARE_URL.includes(\u0027your-tunnel\u0027) || CLOUDFLARE_URL.includes(\u0027example\u0027) || CLOUDFLARE_URL.includes(\u0027xxx\u0027)) {\n  console.log(\u0027[W3] âœ— [CONFIG_MISSING] Cloudflare tunnel URL not configured\u0027);\n  return [{ json: { _error: true, error_code: \u0027CONFIG_MISSING\u0027, error_message: \u0027Cloudflare tunnel URL not configured. Set it in Settings page first. Media files cannot be scheduled without a valid tunnel URL.\u0027, _start_time: startTime, _config_base: CONFIG_BASE } }];\n}\n\nreturn [{ json: { client_filter: CLIENT_FILTER || null, batch_filter: BATCH_FILTER || null, source, db_path: DB_PATH, cloudflare_url: CLOUDFLARE_URL, local_base: settings.paths?.docker_base || \u0027/data/clients\u0027, _start_time: startTime, _config_base: CONFIG_BASE } }];"
                                     },
                      "type":  "n8n-nodes-base.code",
                      "typeVersion":  2,
                      "position":  [
                                       -2144,
                                       304
                                   ],
                      "id":  "7774e3b0-000b-4d86-972d-ce936b941778",
                      "name":  "Load Config"
                  },
                  {
                      "parameters":  {
                                         "conditions":  {
                                                            "options":  {
                                                                            "caseSensitive":  true,
                                                                            "leftValue":  "",
                                                                            "typeValidation":  "loose"
                                                                        },
                                                            "conditions":  [
                                                                               {
                                                                                   "id":  "error-check",
                                                                                   "leftValue":  "={{ $json._error }}",
                                                                                   "rightValue":  true,
                                                                                   "operator":  {
                                                                                                    "type":  "boolean",
                                                                                                    "operation":  "equals"
                                                                                                }
                                                                               }
                                                                           ],
                                                            "combinator":  "and"
                                                        },
                                         "options":  {

                                                     }
                                     },
                      "type":  "n8n-nodes-base.if",
                      "typeVersion":  2,
                      "position":  [
                                       -1920,
                                       304
                                   ],
                      "id":  "33c13e2f-921b-4bb1-beba-046dc3216b80",
                      "name":  "Config Error?"
                  },
                  {
                      "parameters":  {
                                         "jsCode":  "/**\n * W3 v15: Config Error Handler\n * Early exit for configuration errors\n */\nconst fs = require(\u0027fs\u0027);\nconst input = $input.first().json;\nconst startTime = input._start_time || Date.now();\nconst configBase = input._config_base || \u0027/data/clients/_config\u0027;\n\nconsole.log(\u0027[W3] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\u0027);\nconsole.log(`[W3] âœ— Configuration error: ${input.error_code}`);\nconsole.log(`[W3]   ${input.error_message}`);\nconsole.log(\u0027[W3] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\u0027);\n\nconst jobPath = `${configBase}/active_job.json`;\ntry {\n  let jobs = { current: {}, executions: {} };\n  if (fs.existsSync(jobPath)) jobs = JSON.parse(fs.readFileSync(jobPath, \u0027utf8\u0027));\n  if (!jobs.executions) jobs.executions = {};\n  jobs.executions.W3 = { last_run: new Date().toISOString(), status: \u0027failed\u0027, client: input.client_filter || null, batch: input.batch_filter || null, duration_ms: Date.now() - startTime, error_code: input.error_code, error_message: input.error_message };\n  fs.writeFileSync(jobPath, JSON.stringify(jobs, null, 2));\n  console.log(\u0027[W3] âœ“ Job status written to active_job.json\u0027);\n} catch (e) {\n  console.log(`[W3] âš  Could not write job status: ${e.message}`);\n}\n\nreturn [{ json: { success: false, workflow: \u0027W3\u0027, status: \u0027failed\u0027, error_code: input.error_code, error_message: input.error_message, client: input.client_filter || null, batch: input.batch_filter || null, timestamp: new Date().toISOString() } }];"
                                     },
                      "type":  "n8n-nodes-base.code",
                      "typeVersion":  2,
                      "position":  [
                                       -1680,
                                       400
                                   ],
                      "id":  "a50ba0cf-162d-4bb0-8571-0385ca981229",
                      "name":  "Config Error Handler"
                  },
                  {
                      "parameters":  {
                                         "jsCode":  "/**\n * W3 v15: Get APPROVED Items\n * Queries database for approved items ready for scheduling\n */\nconst Database = require(\u0027better-sqlite3\u0027);\nconst fs = require(\u0027fs\u0027);\nconst crypto = require(\u0027crypto\u0027);\n\nconst config = $input.first().json;\nconsole.log(`[W3] â„¹ Opening database: ${config.db_path}`);\n\nlet db;\ntry {\n  db = new Database(config.db_path);\n  db.pragma(\u0027foreign_keys = ON\u0027);\n} catch (e) {\n  console.log(`[W3] âœ— [DB_ERROR] Failed to open database: ${e.message}`);\n  return [{ json: { _error: true, error_code: \u0027DB_ERROR\u0027, error_message: `Failed to open database: ${e.message}`, client_filter: config.client_filter, batch_filter: config.batch_filter, _start_time: config._start_time, _config_base: config._config_base } }];\n}\n\ntry {\n  let query = `\n    SELECT ci.*, c.slug as client_slug, b.slug as batch_slug,\n      ig_acc.late_account_id as db_instagram_account_id,\n      tt_acc.late_account_id as db_tiktok_account_id\n    FROM content_items ci\n    JOIN clients c ON ci.client_id = c.id\n    JOIN batches b ON ci.batch_id = b.id\n    LEFT JOIN accounts ig_acc ON c.id = ig_acc.client_id AND ig_acc.platform = \u0027instagram\u0027 AND (ig_acc.is_default = 1 OR ig_acc.id = (SELECT MIN(id) FROM accounts WHERE client_id = c.id AND platform = \u0027instagram\u0027))\n    LEFT JOIN accounts tt_acc ON c.id = tt_acc.client_id AND tt_acc.platform = \u0027tiktok\u0027 AND (tt_acc.is_default = 1 OR tt_acc.id = (SELECT MIN(id) FROM accounts WHERE client_id = c.id AND platform = \u0027tiktok\u0027))\n    WHERE ci.status = \u0027APPROVED\u0027\n  `;\n\n  const params = [];\n  if (config.client_filter) { query += \u0027 AND c.slug = ?\u0027; params.push(config.client_filter); }\n  if (config.batch_filter) { query += \u0027 AND b.slug = ?\u0027; params.push(config.batch_filter); }\n  query += \u0027 ORDER BY ci.scheduled_date, ci.scheduled_time\u0027;\n\n  const items = db.prepare(query).all(...params);\n  console.log(`[W3] â„¹ Found ${items.length} APPROVED items`);\n\n  if (items.length === 0) {\n    let message = \u0027No APPROVED items found\u0027;\n    if (config.client_filter || config.batch_filter) message += ` for ${config.client_filter || \u0027all\u0027}/${config.batch_filter || \u0027all\u0027}`;\n    console.log(`[W3] âš  [NO_ITEMS] ${message}`);\n    return [{ json: { _skip: true, _no_items: true, message, _config: config } }];\n  }\n\n  const toSchedule = [];\n  const changedRows = [];\n  const alreadyScheduled = [];\n  const itemErrors = [];\n\n  for (const row of items) {\n    // Skip if already scheduled\n    if (row.late_post_id \u0026\u0026 row.late_post_id.trim() !== \u0027\u0027) {\n      alreadyScheduled.push(row.content_id);\n      itemErrors.push({ content_id: row.content_id, code: \u0027ALREADY_SCHEDULED\u0027, message: `Already scheduled with post ID: ${row.late_post_id}` });\n      continue;\n    }\n\n    // Use database account IDs if item doesn\u0027t have them\n    if (!row.instagram_account_id \u0026\u0026 row.db_instagram_account_id) row.instagram_account_id = row.db_instagram_account_id;\n    if (!row.tiktok_account_id \u0026\u0026 row.db_tiktok_account_id) row.tiktok_account_id = row.db_tiktok_account_id;\n\n    // Check for file changes after approval\n    if (row.file_path) {\n      try {\n        if (fs.existsSync(row.file_path)) {\n          const buffer = fs.readFileSync(row.file_path);\n          const currentHash = crypto.createHash(\u0027md5\u0027).update(buffer).digest(\u0027hex\u0027);\n          \n          // Check against approved hash first (if exists)\n          if (row.approved_file_hash \u0026\u0026 row.approved_file_hash.trim() !== \u0027\u0027 \u0026\u0026 currentHash !== row.approved_file_hash) {\n            console.log(`[W3] âš  [FILE_CHANGED] ${row.content_id}: File changed after approval`);\n            changedRows.push({ id: row.id, content_id: row.content_id, status: \u0027NEEDS_REVIEW\u0027, error_message: \u0027FILE_CHANGED_AFTER_APPROVAL\u0027 });\n            itemErrors.push({ content_id: row.content_id, code: \u0027FILE_CHANGED\u0027, message: \u0027File changed after approval - reset to NEEDS_REVIEW\u0027 });\n            continue;\n          }\n          // Fallback: check against ingest hash if no approval hash\n          else if ((!row.approved_file_hash || row.approved_file_hash.trim() === \u0027\u0027) \u0026\u0026 row.file_hash \u0026\u0026 row.file_hash.trim() !== \u0027\u0027 \u0026\u0026 currentHash !== row.file_hash) {\n            console.log(`[W3] âš  [FILE_CHANGED] ${row.content_id}: File changed since ingest (no approval hash)`);\n            changedRows.push({ id: row.id, content_id: row.content_id, status: \u0027NEEDS_REVIEW\u0027, error_message: \u0027FILE_CHANGED_SINCE_INGEST\u0027 });\n            itemErrors.push({ content_id: row.content_id, code: \u0027FILE_CHANGED\u0027, message: \u0027File changed since ingest - reset to NEEDS_REVIEW\u0027 });\n            continue;\n          }\n        }\n      } catch (e) {\n        console.log(`[W3] âš  Could not verify file hash for ${row.content_id}: ${e.message}`);\n      }\n    }\n\n    toSchedule.push(row);\n  }\n\n  console.log(`[W3] â„¹ To schedule: ${toSchedule.length}`);\n  console.log(`[W3] â„¹ Already scheduled: ${alreadyScheduled.length}`);\n  console.log(`[W3] â„¹ File changed: ${changedRows.length}`);\n\n  // Update changed rows\n  if (changedRows.length \u003e 0) {\n    const updateStmt = db.prepare(`UPDATE content_items SET status = ?, error_message = ?, approved_file_hash = NULL WHERE content_id = ?`);\n    const updateMany = db.transaction((rows) =\u003e { for (const row of rows) updateStmt.run(row.status, row.error_message, row.content_id); });\n    updateMany(changedRows);\n    console.log(`[W3] âœ“ Reset ${changedRows.length} changed items to NEEDS_REVIEW`);\n  }\n\n  if (toSchedule.length === 0) {\n    let message = \u0027\u0027;\n    if (changedRows.length \u003e 0) message = `${changedRows.length} items had file changes and were reset. ${alreadyScheduled.length} already scheduled.`;\n    else if (alreadyScheduled.length \u003e 0) message = `All ${alreadyScheduled.length} APPROVED items are already scheduled`;\n    else message = \u0027No items to schedule\u0027;\n    console.log(`[W3] âš  [NO_ITEMS] ${message}`);\n    return [{ json: { _skip: true, _no_items: true, message, _config: config, _changed_count: changedRows.length, _already_scheduled_count: alreadyScheduled.length, _item_errors: itemErrors } }];\n  }\n\n  return toSchedule.map((row, i) =\u003e ({ json: { ...row, _action: \u0027schedule\u0027, _config: config, _changed_count: changedRows.length, _already_scheduled_count: alreadyScheduled.length, _item_errors: i === 0 ? itemErrors : [] } }));\n\n} catch (e) {\n  console.log(`[W3] âœ— [DB_ERROR] Database query failed: ${e.message}`);\n  return [{ json: { _error: true, error_code: \u0027DB_ERROR\u0027, error_message: `Database query failed: ${e.message}`, client_filter: config.client_filter, batch_filter: config.batch_filter, _start_time: config._start_time, _config_base: config._config_base } }];\n} finally {\n  if (db) db.close();\n}"
                                     },
                      "type":  "n8n-nodes-base.code",
                      "typeVersion":  2,
                      "position":  [
                                       -1680,
                                       208
                                   ],
                      "id":  "ff85ad5c-ef7e-416b-804f-0decccc984a1",
                      "name":  "Get APPROVED Items"
                  },
                  {
                      "parameters":  {
                                         "conditions":  {
                                                            "options":  {
                                                                            "caseSensitive":  true,
                                                                            "leftValue":  "",
                                                                            "typeValidation":  "loose"
                                                                        },
                                                            "conditions":  [
                                                                               {
                                                                                   "id":  "skip",
                                                                                   "leftValue":  "={{ $json._skip }}",
                                                                                   "rightValue":  true,
                                                                                   "operator":  {
                                                                                                    "type":  "boolean",
                                                                                                    "operation":  "equals"
                                                                                                }
                                                                               }
                                                                           ],
                                                            "combinator":  "and"
                                                        },
                                         "options":  {

                                                     }
                                     },
                      "type":  "n8n-nodes-base.if",
                      "typeVersion":  2,
                      "position":  [
                                       -1440,
                                       208
                                   ],
                      "id":  "c47039fe-276b-40e6-9ab5-6979a3800ed4",
                      "name":  "Any Items?"
                  },
                  {
                      "parameters":  {
                                         "batchSize":  10,
                                         "options":  {

                                                     }
                                     },
                      "type":  "n8n-nodes-base.splitInBatches",
                      "typeVersion":  3,
                      "position":  [
                                       -1200,
                                       112
                                   ],
                      "id":  "e685d1b2-21bc-4d7c-bbd8-d15794db86e5",
                      "name":  "Process Batches"
                  },
                  {
                      "parameters":  {
                                         "mode":  "runOnceForEachItem",
                                         "jsCode":  "/**\n * W3 v15: Prepare Late Data\n * Formats data for Late API call\n */\nconst item = $json;\nconsole.log(`[W3] â„¹ Preparing: ${item.content_id}`);\n\nconst platforms = (item.platforms || \u0027ig\u0027).split(\u0027,\u0027).map(p =\u003e p.trim().toLowerCase());\nconst hasIG = platforms.includes(\u0027ig\u0027);\nconst hasTT = platforms.includes(\u0027tt\u0027);\n\n// Build caption\nlet caption = \u0027\u0027;\nif (hasIG \u0026\u0026 hasTT) caption = (item.caption_ig || \u0027\u0027).trim();\nelse if (hasIG) caption = (item.caption_ig || \u0027\u0027).trim();\nelse if (hasTT) caption = (item.caption_tt || item.caption_ig || \u0027\u0027).trim();\n\n// Build Late API parameters\nconst latePlatforms = [];\nif (hasIG) latePlatforms.push(\u0027instagram\u0027);\nif (hasTT) latePlatforms.push(\u0027tiktok\u0027);\n\nconst igAccounts = [];\nconst ttAccounts = [];\nif (hasIG \u0026\u0026 item.instagram_account_id) igAccounts.push(item.instagram_account_id);\nif (hasTT \u0026\u0026 item.tiktok_account_id) ttAccounts.push(item.tiktok_account_id);\n\nif (hasIG \u0026\u0026 igAccounts.length === 0) console.log(`[W3] âš  No Instagram account ID for ${item.content_id}`);\nif (hasTT \u0026\u0026 ttAccounts.length === 0) console.log(`[W3] âš  No TikTok account ID for ${item.content_id}`);\n\n// Validate media_type (expected: \u0027photo\u0027 or \u0027video\u0027, Late.com uses \u0027image\u0027/\u0027video\u0027)\nconst VALID_MEDIA_TYPES = [\u0027photo\u0027, \u0027video\u0027];\nif (!VALID_MEDIA_TYPES.includes(item.media_type)) {\n  console.log(`[W3] âš  Unexpected media_type \u0027${item.media_type}\u0027 for ${item.content_id}, defaulting to image`);\n}\nconst lateMediaType = item.media_type === \u0027video\u0027 ? \u0027video\u0027 : \u0027image\u0027;\nconsole.log(`[W3] â„¹ Media: ${lateMediaType}, Platforms: ${latePlatforms.join(\u0027, \u0027)}`);\n\nreturn { json: { id: item.id, content_id: item.content_id, retry_count: parseInt(item.retry_count || \u00270\u0027, 10), file_hash: item.file_hash, file_path: item.file_path, late_caption: caption, late_platforms: latePlatforms, late_schedule_at: item.schedule_at, late_timezone: item.timezone || \u0027Europe/Berlin\u0027, late_media_url: item.media_url, late_media_type: lateMediaType, late_filename: item.file_name, late_ig_accounts: igAccounts, late_tt_accounts: ttAccounts, _has_ig: hasIG, _has_tt: hasTT, _config: item._config, _item_errors: item._item_errors || [] } };"
                                     },
                      "type":  "n8n-nodes-base.code",
                      "typeVersion":  2,
                      "position":  [
                                       -960,
                                       112
                                   ],
                      "id":  "82627333-6637-48e0-a4fe-e48f9098be33",
                      "name":  "Prepare Late Data"
                  },
                  {
                      "parameters":  {
                                         "method":  "HEAD",
                                         "url":  "={{ $json.late_media_url }}",
                                         "options":  {
                                                         "redirect":  {
                                                                          "redirect":  {
                                                                                           "maxRedirects":  5
                                                                                       }
                                                                      },
                                                         "timeout":  3000
                                                     }
                                     },
                      "type":  "n8n-nodes-base.httpRequest",
                      "typeVersion":  4.3,
                      "position":  [
                                       -720,
                                       112
                                   ],
                      "id":  "0e9389d6-add3-4782-b297-6fda013b874f",
                      "name":  "Pre-flight URL Check",
                      "onError":  "continueRegularOutput"
                  },
                  {
                      "parameters":  {
                                         "mode":  "runOnceForEachItem",
                                         "jsCode":  "/**\n * W3 v15: Check Pre-flight Result\n * Validates media URL accessibility\n */\nconst response = $json;\nconst prev = $(\u0027Prepare Late Data\u0027).item.json;\n\nconst statusCode = response.statusCode || response.status || 0;\nconst contentType = response.headers?.[\u0027content-type\u0027] || \u0027\u0027;\nconst contentLength = parseInt(response.headers?.[\u0027content-length\u0027] || \u00270\u0027, 10);\n\nlet preflightOk = false;\nlet preflightError = \u0027\u0027;\nlet preflightErrorCode = \u0027\u0027;\n\nif (statusCode \u003e= 200 \u0026\u0026 statusCode \u003c 300) {\n  preflightOk = true;\n  console.log(`[W3] âœ“ Pre-flight OK for ${prev.content_id}: ${statusCode}, ${contentLength} bytes`);\n} else if (statusCode === 0) {\n  preflightError = \u0027Media URL not accessible (network error or timeout)\u0027;\n  preflightErrorCode = \u0027URL_UNREACHABLE\u0027;\n  console.log(`[W3] âœ— [URL_UNREACHABLE] ${prev.content_id}: No response`);\n} else {\n  preflightError = `Media URL returned HTTP ${statusCode}`;\n  preflightErrorCode = \u0027URL_UNREACHABLE\u0027;\n  console.log(`[W3] âœ— [URL_UNREACHABLE] ${prev.content_id}: HTTP ${statusCode}`);\n}\n\nif (preflightOk \u0026\u0026 prev.late_media_type === \u0027image\u0027 \u0026\u0026 contentType \u0026\u0026 !contentType.includes(\u0027image\u0027)) {\n  preflightOk = false;\n  preflightError = `Invalid content type for image: ${contentType}`;\n  preflightErrorCode = \u0027URL_UNREACHABLE\u0027;\n}\nif (preflightOk \u0026\u0026 prev.late_media_type === \u0027video\u0027 \u0026\u0026 contentType \u0026\u0026 !contentType.includes(\u0027video\u0027) \u0026\u0026 !contentType.includes(\u0027octet-stream\u0027)) {\n  preflightOk = false;\n  preflightError = `Invalid content type for video: ${contentType}`;\n  preflightErrorCode = \u0027URL_UNREACHABLE\u0027;\n}\n\nreturn { json: { ...prev, _preflight_ok: preflightOk, _preflight_error: preflightError, _preflight_error_code: preflightErrorCode, _preflight_status: statusCode, _preflight_content_length: contentLength, _preflight_content_type: contentType } };"
                                     },
                      "type":  "n8n-nodes-base.code",
                      "typeVersion":  2,
                      "position":  [
                                       -480,
                                       112
                                   ],
                      "id":  "60bdbe4a-28e5-42af-bcf6-a827bc391f0b",
                      "name":  "Check Pre-flight Result"
                  },
                  {
                      "parameters":  {
                                         "conditions":  {
                                                            "options":  {
                                                                            "caseSensitive":  true,
                                                                            "leftValue":  "",
                                                                            "typeValidation":  "loose"
                                                                        },
                                                            "conditions":  [
                                                                               {
                                                                                   "id":  "preflight",
                                                                                   "leftValue":  "={{ $json._preflight_ok }}",
                                                                                   "rightValue":  true,
                                                                                   "operator":  {
                                                                                                    "type":  "boolean",
                                                                                                    "operation":  "equals"
                                                                                                }
                                                                               }
                                                                           ],
                                                            "combinator":  "and"
                                                        },
                                         "options":  {

                                                     }
                                     },
                      "type":  "n8n-nodes-base.if",
                      "typeVersion":  2,
                      "position":  [
                                       -240,
                                       112
                                   ],
                      "id":  "9f2448d7-b151-45a6-ab54-5aad7cc6cf05",
                      "name":  "Pre-flight OK?"
                  },
                  {
                      "parameters":  {
                                         "mode":  "runOnceForEachItem",
                                         "jsCode":  "/**\n * W3 v14: Handle Pre-flight Failure\n * Returns failure result for unreachable media URLs\n */\nconst prev = $json;\nconsole.log(`[W3] âœ— [URL_UNREACHABLE] Skipping Late API call: ${prev.content_id}`);\n\nreturn { json: { id: prev.id, content_id: prev.content_id, late_post_id: \u0027\u0027, late_media_id: \u0027\u0027, late_media_url: \u0027\u0027, status: \u0027FAILED\u0027, error_message: prev._preflight_error || \u0027Media URL not accessible\u0027, error_code: \u0027URL_UNREACHABLE\u0027, retry_count: prev.retry_count + 1, approved_file_hash: \u0027\u0027, _config: prev._config, _item_errors: prev._item_errors || [] } };"
                                     },
                      "type":  "n8n-nodes-base.code",
                      "typeVersion":  2,
                      "position":  [
                                       0,
                                       0
                                   ],
                      "id":  "daf3c074-d24d-4d74-9f4e-2e74805ee4c8",
                      "name":  "Handle Pre-flight Failure"
                  },
                  {
                      "parameters":  {
                                         "resource":  "posts",
                                         "operation":  "create",
                                         "content":  "={{ $json.late_caption }}",
                                         "scheduledFor":  "={{ $json.late_schedule_at }}",
                                         "timezone":  "={{ $json.late_timezone }}",
                                         "selectedPlatforms":  "={{ $json.late_platforms }}",
                                         "instagramAccounts":  "={{ $json.late_ig_accounts }}",
                                         "tiktokAccounts":  "={{ $json.late_tt_accounts }}",
                                         "mediaItems":  {
                                                            "items":  [
                                                                          {
                                                                              "type":  "={{ $json.late_media_type }}",
                                                                              "url":  "={{ $json.late_media_url }}"
                                                                          }
                                                                      ]
                                                        },
                                         "twitterThreadItems":  {
                                                                    "items":  [

                                                                              ]
                                                                },
                                         "threadsThreadItems":  {
                                                                    "items":  [

                                                                              ]
                                                                },
                                         "requestOptions":  {

                                                            }
                                     },
                      "type":  "n8n-nodes-late.late",
                      "typeVersion":  1,
                      "position":  [
                                       0,
                                       208
                                   ],
                      "id":  "9a815199-5eac-4ea3-9502-49662c5a060b",
                      "name":  "Create Late Post",
                      "credentials":  {
                                          "lateApi":  {
                                                          "id":  "f7HR2n0CeD8DnWuZ",
                                                          "name":  "LATE account"
                                                      }
                                      },
                      "onError":  "continueRegularOutput"
                  },
                  {
                      "parameters":  {
                                         "mode":  "runOnceForEachItem",
                                         "jsCode":  "/**\n * W3 v14: Process Result\n * Handles Late API response and determines success/failure\n */\nconst response = $json;\nconst prev = $(\u0027Check Pre-flight Result\u0027).item.json;\n\nlet result = { id: prev.id, content_id: prev.content_id, late_post_id: \u0027\u0027, late_media_id: \u0027\u0027, late_media_url: \u0027\u0027, status: \u0027SCHEDULED\u0027, error_message: \u0027\u0027, error_code: null, retry_count: prev.retry_count, approved_file_hash: prev.file_hash || \u0027\u0027, _config: prev._config, _item_errors: prev._item_errors || [] };\n\nconst postId = response.id || response._id || response.postId || response.post_id || \u0027\u0027;\nconst hasSuccess = postId || response.success === true || (response.message \u0026\u0026 (response.message.toLowerCase().includes(\u0027success\u0027) || response.message.toLowerCase().includes(\u0027scheduled\u0027) || response.message.toLowerCase().includes(\u0027created\u0027)));\n\nconst isAuthError = response.statusCode === 401 || response.statusCode === 403 || (response.message \u0026\u0026 (response.message.toLowerCase().includes(\u0027unauthorized\u0027) || response.message.toLowerCase().includes(\u0027token\u0027) || response.message.toLowerCase().includes(\u0027expired\u0027) || response.message.toLowerCase().includes(\u0027authentication\u0027)));\n\nconst hasError = response.error || response.statusCode \u003e= 400 || response.code === \u0027ERR\u0027 || (response.message \u0026\u0026 (response.message.toLowerCase().includes(\u0027error\u0027) || response.message.toLowerCase().includes(\u0027bad request\u0027) || response.message.toLowerCase().includes(\u0027invalid\u0027) || response.message.toLowerCase().includes(\u0027failed\u0027)));\n\nif (hasSuccess \u0026\u0026 !hasError) {\n  result.late_post_id = String(postId || \u0027scheduled\u0027);\n  result.late_media_id = String(response.mediaId || response.media_id || \u0027\u0027);\n  result.late_media_url = String(response.mediaUrl || response.media_url || \u0027\u0027);\n  result.error_message = response.message || \u0027Post scheduled successfully\u0027;\n  console.log(`[W3] âœ“ Scheduled: ${prev.content_id} â†’ ${result.late_post_id}`);\n  return { json: result };\n}\n\nif (isAuthError) {\n  result.status = \u0027FAILED\u0027;\n  result.error_code = \u0027LATE_AUTH_EXPIRED\u0027;\n  result.error_message = response.error || response.message || \u0027Late API authentication failed\u0027;\n  result.retry_count = prev.retry_count + 1;\n  result.approved_file_hash = \u0027\u0027;\n  console.log(`[W3] âœ— [LATE_AUTH_EXPIRED] ${prev.content_id}: ${result.error_message}`);\n  return { json: result };\n}\n\nif (hasError) {\n  result.status = \u0027FAILED\u0027;\n  result.error_code = \u0027LATE_API_ERROR\u0027;\n  result.error_message = response.error || response.message || `HTTP ${response.statusCode || response.code || \u0027unknown\u0027}`;\n  result.retry_count = prev.retry_count + 1;\n  result.approved_file_hash = \u0027\u0027;\n  console.log(`[W3] âœ— [LATE_API_ERROR] ${prev.content_id}: ${result.error_message}`);\n  return { json: result };\n}\n\nif (response.message \u0026\u0026 !hasError) {\n  result.late_post_id = \u0027scheduled\u0027;\n  result.error_message = response.message;\n  console.log(`[W3] âœ“ Likely scheduled: ${prev.content_id}`);\n  return { json: result };\n}\n\nresult.status = \u0027FAILED\u0027;\nresult.error_code = \u0027LATE_API_ERROR\u0027;\nresult.error_message = \u0027Unknown response from Late API\u0027;\nresult.retry_count = prev.retry_count + 1;\nconsole.log(`[W3] âœ— [LATE_API_ERROR] ${prev.content_id}: Unknown response`);\nreturn { json: result };"
                                     },
                      "type":  "n8n-nodes-base.code",
                      "typeVersion":  2,
                      "position":  [
                                       240,
                                       208
                                   ],
                      "id":  "eaa51ca1-bbfd-42d7-a1d6-14e4e4a54296",
                      "name":  "Process Result"
                  },
                  {
                      "parameters":  {
                                         "jsCode":  "const items = $input.all();\nreturn items;"
                                     },
                      "type":  "n8n-nodes-base.code",
                      "typeVersion":  2,
                      "position":  [
                                       480,
                                       112
                                   ],
                      "id":  "0ea1418a-5a99-40e8-b323-f0a991fe7c6b",
                      "name":  "Merge Results"
                  },
                  {
                      "parameters":  {
                                         "jsCode":  "/**\n * W3 v14: Update Database\n * Saves scheduling results to SQLite\n */\nconst Database = require(\u0027better-sqlite3\u0027);\nconst items = $input.all();\n\nif (items.length === 0) return items;\n\nconst dbPath = items[0].json._config?.db_path;\nif (!dbPath) {\n  console.log(\u0027[W3] âš  No database path found, skipping update\u0027);\n  return items;\n}\n\nconsole.log(`[W3] â„¹ Updating database: ${dbPath}`);\nconst db = new Database(dbPath);\ndb.pragma(\u0027foreign_keys = ON\u0027);\n\ntry {\n  const updateStmt = db.prepare(`\n    UPDATE content_items\n    SET late_post_id = ?, late_media_id = ?, late_media_url = ?, status = ?, error_message = ?, retry_count = ?, approved_file_hash = ?,\n        scheduled_at = CASE WHEN ? = \u0027SCHEDULED\u0027 THEN datetime(\u0027now\u0027) ELSE scheduled_at END\n    WHERE content_id = ?\n  `);\n\n  const insertAudit = db.prepare(`INSERT INTO audit_log (entity_type, entity_id, action, new_value) VALUES (\u0027content_item\u0027, ?, \u0027schedule\u0027, ?)`);\n\n  const updateMany = db.transaction((items) =\u003e {\n    for (const item of items) {\n      const d = item.json;\n      updateStmt.run(d.late_post_id || null, d.late_media_id || null, d.late_media_url || null, d.status, d.error_message || null, d.retry_count || 0, d.approved_file_hash || null, d.status, d.content_id);\n      if (d.status === \u0027SCHEDULED\u0027) {\n        insertAudit.run(d.id, JSON.stringify({ late_post_id: d.late_post_id, schedule_at: new Date().toISOString() }));\n      }\n    }\n  });\n\n  updateMany(items);\n\n  const scheduledCount = items.filter(i =\u003e i.json.status === \u0027SCHEDULED\u0027).length;\n  const failedCount = items.filter(i =\u003e i.json.status === \u0027FAILED\u0027).length;\n  console.log(`[W3] âœ“ Database updated: ${scheduledCount} scheduled, ${failedCount} failed`);\n\n} finally {\n  db.close();\n}\n\nreturn items;"
                                     },
                      "type":  "n8n-nodes-base.code",
                      "typeVersion":  2,
                      "position":  [
                                       720,
                                       112
                                   ],
                      "id":  "b6fedcfc-c4a4-4190-9af6-cb625c551970",
                      "name":  "Update Database"
                  },
                  {
                      "parameters":  {

                                     },
                      "type":  "n8n-nodes-base.noOp",
                      "typeVersion":  1,
                      "position":  [
                                       960,
                                       112
                                   ],
                      "id":  "d8e2688f-341e-4214-9486-ca17fe8bba15",
                      "name":  "Next"
                  },
                  {
                      "parameters":  {
                                         "jsCode":  "/**\n * W3 v14: No Items\n * Handles empty result when no APPROVED items found\n */\nconst fs = require(\u0027fs\u0027);\nconst data = $json;\nconst config = data._config || {};\nconst startTime = config._start_time || Date.now();\nconst configBase = config._config_base || \u0027/data/clients/_config\u0027;\n\nconsole.log(\u0027[W3] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\u0027);\nconsole.log(`[W3] Summary: ${data.message || \u0027No APPROVED items found\u0027}`);\nif (data._changed_count \u003e 0) console.log(`[W3] âš  ${data._changed_count} items reset due to file changes`);\nconsole.log(\u0027[W3] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\u0027);\n\nconst jobPath = `${configBase}/active_job.json`;\ntry {\n  let jobs = { current: {}, executions: {} };\n  if (fs.existsSync(jobPath)) jobs = JSON.parse(fs.readFileSync(jobPath, \u0027utf8\u0027));\n  if (!jobs.executions) jobs.executions = {};\n  jobs.executions.W3 = { last_run: new Date().toISOString(), status: \u0027success\u0027, client: config.client_filter || null, batch: config.batch_filter || null, duration_ms: Date.now() - startTime, summary: { total: 0, scheduled: 0, failed: 0, file_changed: data._changed_count || 0, already_scheduled: data._already_scheduled_count || 0 } };\n  if (data._item_errors \u0026\u0026 data._item_errors.length \u003e 0) jobs.executions.W3.warnings = data._item_errors;\n  fs.writeFileSync(jobPath, JSON.stringify(jobs, null, 2));\n  console.log(\u0027[W3] âœ“ Job status written to active_job.json\u0027);\n} catch (e) {\n  console.log(`[W3] âš  Could not write job status: ${e.message}`);\n}\n\nreturn [{ json: { success: true, workflow: \u0027W3\u0027, status: \u0027success\u0027, message: data.message || \u0027Nothing to schedule\u0027, source: config.source || \u0027unknown\u0027, client: config.client_filter || null, batch: config.batch_filter || null, summary: { total: 0, scheduled: 0, failed: 0, file_changed: data._changed_count || 0, already_scheduled: data._already_scheduled_count || 0 }, database: config.db_path, timestamp: new Date().toISOString() } }];"
                                     },
                      "type":  "n8n-nodes-base.code",
                      "typeVersion":  2,
                      "position":  [
                                       -1200,
                                       304
                                   ],
                      "id":  "2f4abfc0-5c78-451a-9663-b0b96ba6064d",
                      "name":  "No Items"
                  },
                  {
                      "parameters":  {
                                         "jsCode":  "/**\n * W3 v14: Summary\n * Generates final report and writes job status\n */\nconst fs = require(\u0027fs\u0027);\nconst allResults = $input.all();\nconst results = allResults.filter(i =\u003e i.json.content_id \u0026\u0026 i.json.status \u0026\u0026 (i.json.status === \u0027SCHEDULED\u0027 || i.json.status === \u0027FAILED\u0027));\n\nlet config = {};\nlet existingItemErrors = [];\nfor (const item of allResults) {\n  if (item.json._config) config = item.json._config;\n  if (item.json._item_errors \u0026\u0026 item.json._item_errors.length \u003e 0) existingItemErrors = item.json._item_errors;\n}\n\nconst startTime = config._start_time || $(\u0027Load Config\u0027).first().json._start_time || Date.now();\nconst configBase = config._config_base || \u0027/data/clients/_config\u0027;\nconst duration = Date.now() - startTime;\n\nconst scheduled = results.filter(i =\u003e i.json.status === \u0027SCHEDULED\u0027).length;\nconst failed = results.filter(i =\u003e i.json.status === \u0027FAILED\u0027).length;\nconst total = results.length;\n\nconst itemErrors = [...existingItemErrors];\nfor (const item of results) {\n  if (item.json.status === \u0027FAILED\u0027) {\n    itemErrors.push({ content_id: item.json.content_id, code: item.json.error_code || \u0027UNKNOWN\u0027, message: item.json.error_message || \u0027Unknown error\u0027 });\n  }\n}\n\nconst preflightFailed = results.filter(i =\u003e i.json.error_code === \u0027URL_UNREACHABLE\u0027).length;\n\nlet fileChanged = 0;\ntry { const firstItem = $(\u0027Get APPROVED Items\u0027).first()?.json; fileChanged = firstItem?._changed_count || 0; } catch (e) {}\n\nlet overallStatus = \u0027success\u0027;\nif (failed \u003e 0 \u0026\u0026 scheduled === 0) overallStatus = \u0027failed\u0027;\nelse if (failed \u003e 0) overallStatus = \u0027partial\u0027;\n\nconst jobPath = `${configBase}/active_job.json`;\ntry {\n  let jobs = { current: {}, executions: {} };\n  if (fs.existsSync(jobPath)) jobs = JSON.parse(fs.readFileSync(jobPath, \u0027utf8\u0027));\n  if (!jobs.executions) jobs.executions = {};\n  jobs.executions.W3 = { last_run: new Date().toISOString(), status: overallStatus, client: config.client_filter || null, batch: config.batch_filter || null, duration_ms: duration, summary: { total, scheduled, failed, preflight_failed: preflightFailed, file_changed: fileChanged } };\n  if (itemErrors.length \u003e 0) jobs.executions.W3.errors = itemErrors;\n  fs.writeFileSync(jobPath, JSON.stringify(jobs, null, 2));\n  console.log(\u0027[W3] âœ“ Job status written to active_job.json\u0027);\n} catch (e) {\n  console.log(`[W3] âš  Could not write job status: ${e.message}`);\n}\n\nconst report = { success: overallStatus === \u0027success\u0027, workflow: \u0027W3\u0027, version: \u002714\u0027, status: overallStatus, generated_at: new Date().toISOString(), duration_ms: duration, source: config.source || \u0027unknown\u0027, client: config.client_filter || null, batch: config.batch_filter || null, summary: { total, scheduled, failed, preflight_failed: preflightFailed, file_changed: fileChanged, success_rate: total \u003e 0 ? ((scheduled / total) * 100).toFixed(1) + \u0027%\u0027 : \u0027N/A\u0027 } };\n\nif (itemErrors.length \u003e 0) report.errors = itemErrors;\n\nconst scheduledItems = results.filter(i =\u003e i.json.status === \u0027SCHEDULED\u0027).map(i =\u003e ({ content_id: i.json.content_id, late_post_id: i.json.late_post_id }));\nif (scheduledItems.length \u003e 0) report.scheduled_items = scheduledItems;\n\nconst nextSteps = [];\nif (preflightFailed \u003e 0) nextSteps.push(`${preflightFailed} items failed pre-flight - check Cloudflare tunnel`);\nif (failed \u003e 0) nextSteps.push(`Check ${failed} failed items in Approval UI`);\nif (scheduled \u003e 0) {\n  nextSteps.push(`${scheduled} posts scheduled in Late`);\n  nextSteps.push(\u0027Check Late dashboard to verify posts\u0027);\n}\nif (nextSteps.length \u003e 0) report.next_steps = nextSteps;\n\nconsole.log(\u0027[W3] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\u0027);\nconsole.log(`[W3] Summary: ${config.client_filter || \u0027all\u0027}/${config.batch_filter || \u0027all\u0027}`);\nconsole.log(\u0027[W3] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\u0027);\nconsole.log(`[W3] Total: ${total}, Scheduled: ${scheduled}, Failed: ${failed}`);\nconsole.log(`[W3] Status: ${overallStatus.toUpperCase()}`);\nconsole.log(`[W3] Duration: ${(duration / 1000).toFixed(1)}s`);\nconsole.log(\u0027[W3] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\u0027);\n\nreturn [{ json: report }];"
                                     },
                      "type":  "n8n-nodes-base.code",
                      "typeVersion":  2,
                      "position":  [
                                       960,
                                       304
                                   ],
                      "id":  "70cd0ea5-813a-4232-b587-d94f379d2ca3",
                      "name":  "Summary"
                  },
                  {
                      "parameters":  {
                                         "respondWith":  "json",
                                         "responseBody":  "={{ $json }}",
                                         "options":  {

                                                     }
                                     },
                      "type":  "n8n-nodes-base.respondToWebhook",
                      "typeVersion":  1.5,
                      "position":  [
                                       1200,
                                       304
                                   ],
                      "id":  "39c2dd5f-8bbd-41ca-9bc1-7cdb9b3a8f84",
                      "name":  "Webhook Response"
                  }
              ],
    "connections":  {
                        "Webhook Trigger":  {
                                                "main":  [
                                                             [
                                                                 {
                                                                     "node":  "Load Config",
                                                                     "type":  "main",
                                                                     "index":  0
                                                                 }
                                                             ]
                                                         ]
                                            },
                        "Load Config":  {
                                            "main":  [
                                                         [
                                                             {
                                                                 "node":  "Config Error?",
                                                                 "type":  "main",
                                                                 "index":  0
                                                             }
                                                         ]
                                                     ]
                                        },
                        "Config Error?":  {
                                              "main":  [
                                                           [
                                                               {
                                                                   "node":  "Config Error Handler",
                                                                   "type":  "main",
                                                                   "index":  0
                                                               }
                                                           ],
                                                           [
                                                               {
                                                                   "node":  "Get APPROVED Items",
                                                                   "type":  "main",
                                                                   "index":  0
                                                               }
                                                           ]
                                                       ]
                                          },
                        "Config Error Handler":  {
                                                     "main":  [
                                                                  [
                                                                      {
                                                                          "node":  "Webhook Response",
                                                                          "type":  "main",
                                                                          "index":  0
                                                                      }
                                                                  ]
                                                              ]
                                                 },
                        "Get APPROVED Items":  {
                                                   "main":  [
                                                                [
                                                                    {
                                                                        "node":  "Any Items?",
                                                                        "type":  "main",
                                                                        "index":  0
                                                                    }
                                                                ]
                                                            ]
                                               },
                        "Any Items?":  {
                                           "main":  [
                                                        [
                                                            {
                                                                "node":  "No Items",
                                                                "type":  "main",
                                                                "index":  0
                                                            }
                                                        ],
                                                        [
                                                            {
                                                                "node":  "Process Batches",
                                                                "type":  "main",
                                                                "index":  0
                                                            }
                                                        ]
                                                    ]
                                       },
                        "Process Batches":  {
                                                "main":  [
                                                             [
                                                                 {
                                                                     "node":  "Summary",
                                                                     "type":  "main",
                                                                     "index":  0
                                                                 }
                                                             ],
                                                             [
                                                                 {
                                                                     "node":  "Prepare Late Data",
                                                                     "type":  "main",
                                                                     "index":  0
                                                                 }
                                                             ]
                                                         ]
                                            },
                        "Prepare Late Data":  {
                                                  "main":  [
                                                               [
                                                                   {
                                                                       "node":  "Pre-flight URL Check",
                                                                       "type":  "main",
                                                                       "index":  0
                                                                   }
                                                               ]
                                                           ]
                                              },
                        "Pre-flight URL Check":  {
                                                     "main":  [
                                                                  [
                                                                      {
                                                                          "node":  "Check Pre-flight Result",
                                                                          "type":  "main",
                                                                          "index":  0
                                                                      }
                                                                  ]
                                                              ]
                                                 },
                        "Check Pre-flight Result":  {
                                                        "main":  [
                                                                     [
                                                                         {
                                                                             "node":  "Pre-flight OK?",
                                                                             "type":  "main",
                                                                             "index":  0
                                                                         }
                                                                     ]
                                                                 ]
                                                    },
                        "Pre-flight OK?":  {
                                               "main":  [
                                                            [
                                                                {
                                                                    "node":  "Handle Pre-flight Failure",
                                                                    "type":  "main",
                                                                    "index":  0
                                                                }
                                                            ],
                                                            [
                                                                {
                                                                    "node":  "Create Late Post",
                                                                    "type":  "main",
                                                                    "index":  0
                                                                }
                                                            ]
                                                        ]
                                           },
                        "Handle Pre-flight Failure":  {
                                                          "main":  [
                                                                       [
                                                                           {
                                                                               "node":  "Merge Results",
                                                                               "type":  "main",
                                                                               "index":  0
                                                                           }
                                                                       ]
                                                                   ]
                                                      },
                        "Create Late Post":  {
                                                 "main":  [
                                                              [
                                                                  {
                                                                      "node":  "Process Result",
                                                                      "type":  "main",
                                                                      "index":  0
                                                                  }
                                                              ]
                                                          ]
                                             },
                        "Process Result":  {
                                               "main":  [
                                                            [
                                                                {
                                                                    "node":  "Merge Results",
                                                                    "type":  "main",
                                                                    "index":  0
                                                                }
                                                            ]
                                                        ]
                                           },
                        "Merge Results":  {
                                              "main":  [
                                                           [
                                                               {
                                                                   "node":  "Update Database",
                                                                   "type":  "main",
                                                                   "index":  0
                                                               }
                                                           ]
                                                       ]
                                          },
                        "Update Database":  {
                                                "main":  [
                                                             [
                                                                 {
                                                                     "node":  "Next",
                                                                     "type":  "main",
                                                                     "index":  0
                                                                 }
                                                             ]
                                                         ]
                                            },
                        "Next":  {
                                     "main":  [
                                                  [
                                                      {
                                                          "node":  "Process Batches",
                                                          "type":  "main",
                                                          "index":  0
                                                      }
                                                  ]
                                              ]
                                 },
                        "No Items":  {
                                         "main":  [
                                                      [
                                                          {
                                                              "node":  "Webhook Response",
                                                              "type":  "main",
                                                              "index":  0
                                                          }
                                                      ]
                                                  ]
                                     },
                        "Summary":  {
                                        "main":  [
                                                     [
                                                         {
                                                             "node":  "Webhook Response",
                                                             "type":  "main",
                                                             "index":  0
                                                         }
                                                     ]
                                                 ]
                                    }
                    },
    "settings":  {
                     "executionOrder":  "v1",
                     "callerPolicy":  "workflowsFromSameOwner",
                     "availableInMCP":  true
                 },
    "pinData":  {

                },
    "active":  true,
    "meta":  {
                 "templateCredsSetupCompleted":  true
             },
    "tags":  [

             ],
    "versionId":  "363dc165-0372-4bdd-a964-c4ca6607122e"
}
